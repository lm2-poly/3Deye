

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Velocity &mdash; 3Drecons 1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Camera object" href="../function_list.html" />
    <link rel="prev" title="Using the GUI" href="../calibration/gui.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> 3Drecons
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">User guide:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">3D trajectory reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html#calibration">Calibration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html#post-processing">Post-processing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Velocity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shooting-angle">Shooting angle</a></li>
<li class="toctree-l2"><a class="reference internal" href="#impact-position">Impact position</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-gui">Using the GUI</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Functions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html">Camera object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html#module-calibration.main">Camera calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html#module-data_treat.reconstruction_3d">3D Trajectory reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html#module-data_treat.data_pp">Trajectory post-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html#module-data_treat.make_report">Report generation and save</a></li>
<li class="toctree-l1"><a class="reference internal" href="../function_list.html#module-gui.recons_gui">GUI fonctions</a></li>
</ul>
<p class="caption"><span class="caption-text">Credits:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../credits.html">Credits</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">3Drecons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user_guide.html">3D trajectory reconstruction</a> &raquo;</li>
        
      <li>Velocity</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/contents/post_proc/post_proc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="velocity">
<h1>Velocity<a class="headerlink" href="#velocity" title="Permalink to this headline">¶</a></h1>
<p>The velocity before and after the impact can be computed using the <a class="reference internal" href="#data_treat.data_pp.get_velocity" title="data_treat.data_pp.get_velocity"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_treat.data_pp.get_velocity()</span></code></a> function.</p>
<dl class="py function">
<dt id="data_treat.data_pp.get_velocity">
<code class="sig-prename descclassname">data_treat.data_pp.</code><code class="sig-name descname">get_velocity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ti</span></em>, <em class="sig-param"><span class="n">Xi</span></em>, <em class="sig-param"><span class="n">Yi</span></em>, <em class="sig-param"><span class="n">Zi</span></em>, <em class="sig-param"><span class="n">thres</span><span class="o">=</span><span class="default_value">1.3</span></em>, <em class="sig-param"><span class="n">plot</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">saveDir</span><span class="o">=</span><span class="default_value">'data_treat/'</span></em>, <em class="sig-param"><span class="n">init</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">pt_num</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/data_treat/data_pp.html#get_velocity"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#data_treat.data_pp.get_velocity" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the shot velocity before and after the impact by linear fit.
Before the impact, the functions continues adding the next acquisition point to the linear fit until the
new points reduces the fit success score at less then the previous score * threshold. Then the first point with
constant velocity after the impact is searched so that lienar fit with the same number of points as before the
impact yields a better score than before the impact. It is based on the assumption that there will always be
more acquisition point after the impact than before.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>t</strong> – time vector</p></li>
<li><p><strong>Xi</strong><strong>,</strong><strong>Yi</strong><strong>,</strong><strong>Zi</strong> – 3D coordinates (ndarray)</p></li>
<li><p><strong>thres</strong> – threshold for the accepted residual difference (default 1.3)</p></li>
<li><p><strong>plot</strong> – True or False indicate if should plot a verification picture</p></li>
<li><p><strong>saveDir</strong> – Directory to save the picture to</p></li>
<li><p><strong>init</strong> – initial index to compute the initial velocity</p></li>
<li><p><strong>pt_num</strong> – minimum number of points to use to compute the velocity</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>VX,VY,VZ initial velocity vector coordinates</p>
</dd>
</dl>
</dd></dl>

<p>The function first computes the shot velocity after impact by linear regression betwen <cite>init</cite> and <cite>init + pt_num</cite> position. It then adds the next point of the position curve to the linear regression and continus adding point as soon as the regression quality does not fall under <cite>threshold</cite> times the best regression quality. This ensures using as many points as possible to compute the velocity while stoping before the impact.</p>
<p>The function then start from the last point used for the regression and perfomes a linear regression of the <cite>N</cite> following points (<cite>N</cite> being the number of points used to get the initial velocity). The initial point is then changed until the regression score falls under <span class="math notranslate nohighlight">\(10^{-4}\)</span>. This ensures that the same number of points will be taken to compute the velocity before and after the impact, to provide an estimate with a similar accuracy.</p>
<p>This procedure is performed on the Y direction as it posess the strongest derivative. The computed index for linear regression are then re-used to obtain the X and Z velocity values.</p>
<p>Finally, if the <cite>plot</cite> parameter is set to True, the function will superimpose the shot trajectory with the linear regression used for the velocities determination to check the relevence of teh chosen index. To enhance the estimation, the user can play with the initial index, point number and detection threshold values.</p>
<img alt="../../_images/velocity.png" class="align-center" src="../../_images/velocity.png" />
</div>
<div class="section" id="shooting-angle">
<h1>Shooting angle<a class="headerlink" href="#shooting-angle" title="Permalink to this headline">¶</a></h1>
<p>The shooting angle toward to horizontal axis can be computed using the <a class="reference internal" href="#data_treat.data_pp.get_init_angle" title="data_treat.data_pp.get_init_angle"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_treat.data_pp.get_init_angle()</span></code></a> function.</p>
<dl class="py function">
<dt id="data_treat.data_pp.get_init_angle">
<code class="sig-prename descclassname">data_treat.data_pp.</code><code class="sig-name descname">get_init_angle</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">Xi</span></em>, <em class="sig-param"><span class="n">Yi</span></em>, <em class="sig-param"><span class="n">Zi</span></em>, <em class="sig-param"><span class="n">ti</span></em>, <em class="sig-param"><span class="n">cam_top</span></em>, <em class="sig-param"><span class="n">cam_left</span></em>, <em class="sig-param"><span class="n">plot</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">saveDir</span><span class="o">=</span><span class="default_value">'data_treat/'</span></em>, <em class="sig-param"><span class="n">init</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">end</span><span class="o">=</span><span class="default_value">2</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/data_treat/data_pp.html#get_init_angle"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#data_treat.data_pp.get_init_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the shot trajectory angle relatively to the shooting axis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong><strong>,</strong><strong>Y</strong><strong>,</strong><strong>Z</strong> – reconstructed X, Y, and Z coordinates (ndarray)</p></li>
<li><p><strong>timespan</strong> – time point list</p></li>
<li><p><strong>cam_top</strong><strong>,</strong><strong>cam_left</strong> – camera objects</p></li>
<li><p><strong>plot</strong> – True or False indicate if should plot a verification picture</p></li>
<li><p><strong>saveDir</strong> – Directory to save the picture to</p></li>
<li><p><strong>init</strong><strong>,</strong><strong>end</strong> – initial and final array index used to average the angle value (default: 0 and 2)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<p>The function first computes the velocity vector <span class="math notranslate nohighlight">\(V\)</span> between the init and end indexes. Then, the angle <span class="math notranslate nohighlight">\(\alpha\)</span> between the velociy vectr and the Y axis is computed using the following relation:</p>
<p><span class="math notranslate nohighlight">\(\alpha = arccos(\frac{V_y}{||V||})\)</span></p>
<p>If the plot parameter is set to True, the function will then plot the projection of the velocity vector on each camera, superimposed with the <cite>end - init</cite> first picture sum to compare the vector orientation with the shots apparent angle. If the vector does not seem to match with the shot direction, you can either add more points to the vector estimation or do the 3D trajectory analysis with different threshold parameters to get a better estimation of the shot positions.</p>
<img alt="../../_images/angle.png" class="align-center" src="../../_images/angle.png" />
</div>
<div class="section" id="impact-position">
<h1>Impact position<a class="headerlink" href="#impact-position" title="Permalink to this headline">¶</a></h1>
<p>The shooting angle toward to horizontal axis can be computed using the <a class="reference internal" href="#data_treat.data_pp.get_impact_position" title="data_treat.data_pp.get_impact_position"><code class="xref py py-func docutils literal notranslate"><span class="pre">data_treat.data_pp.get_impact_position()</span></code></a> function.</p>
<dl class="py function">
<dt id="data_treat.data_pp.get_impact_position">
<code class="sig-prename descclassname">data_treat.data_pp.</code><code class="sig-name descname">get_impact_position</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">X</span></em>, <em class="sig-param"><span class="n">Y</span></em>, <em class="sig-param"><span class="n">Z</span></em>, <em class="sig-param"><span class="n">cam_left</span></em>, <em class="sig-param"><span class="n">cam_top</span></em>, <em class="sig-param"><span class="n">plot</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">saveDir</span><span class="o">=</span><span class="default_value">'data_treat/'</span></em>, <em class="sig-param"><span class="n">threshold</span><span class="o">=</span><span class="default_value">0.995</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/data_treat/data_pp.html#get_impact_position"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#data_treat.data_pp.get_impact_position" title="Permalink to this definition">¶</a></dt>
<dd><p>Automatic detection of the moment of impact simply by taking the moment where Y changes direction, within a given threshold</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong><strong>,</strong><strong>Y</strong><strong>,</strong><strong>Z</strong> – reconstructed X, Y, and Z coordinates (ndarray)</p></li>
<li><p><strong>cam_left</strong><strong>,</strong><strong>cam_top</strong> – left and top camera objects.</p></li>
<li><p><strong>plot</strong> – True or False indicate if should plot a verification picture</p></li>
<li><p><strong>saveDir</strong> – Directory to save the picture to</p></li>
<li><p><strong>threshold</strong> – impact detection threshold</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>impact X,Y,Z position relative to the first detected shot picture position.</p>
</dd>
</dl>
</dd></dl>

<p>The function travels along the shot Y coordinatesuntil the direction of the shot changes, e.g., until
<span class="math notranslate nohighlight">\(Y[i+1] &lt;  threshold * Y[i]\)</span></p>
<p>If the plot parameter is set to True, the function will plot the impact position superimposed with the different shot picture and detected trajectory. The threshold can be adjusted according to the sharpness of the rebound.</p>
<img alt="../../_images/impact.png" class="align-center" src="../../_images/impact.png" />
</div>
<div class="section" id="using-the-gui">
<h1>Using the GUI<a class="headerlink" href="#using-the-gui" title="Permalink to this headline">¶</a></h1>
<p>All the above post-processing analysis can be performed using the user interface “Post processing” tab.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The post processing tab will only unlock once an analysis has been performed or loaded using the “Load analysis” or the “Analysis” tab respectively.</p>
</div>
<img alt="../../_images/pp_GUI.png" class="align-center" src="../../_images/pp_GUI.png" />
<p>All the parameters detailed above can be changed using the user interface forms. After launching the post-processing analysis, the user interface will plot the different images detailed above for the velocity, angle and impact position determination check. The user can adjust the different parameters accordingly to improve the estimations.</p>
<p>Once satisfied with the results, the whole analysis can be saved in a text file report by pressing the “Save result button”
The report contains:</p>
<ul class="simple">
<li><p>the experiment parameters (shot, sample, pressure)</p></li>
<li><p>the post-processing results (velocity, angle, impact position)</p></li>
<li><p>The recovered 3D trajectory (t, X, Y, Z)</p></li>
<li><p>The camera parameters</p></li>
</ul>
<p>This reports can also be loaded in a future session using the “Load analysis” tab by simply entering the report path in the form. After loading the user can perform a new post-processing with different parameters and save it back again.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../function_list.html" class="btn btn-neutral float-right" title="Camera object" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../calibration/gui.html" class="btn btn-neutral float-left" title="Using the GUI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, S.Breumier

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>